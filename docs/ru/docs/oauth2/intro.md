# Реализация OAuth2

Сервис Auth-movies предоставляет возможность авторизации пользователей с помощью социальных сетей
по протоколу [OAuth2](https://ru.wikipedia.org/wiki/OAuth).

## Поддерживаемые провайдеры
Поддерживаются следующие провайдеры социальных сетей:

1. Yandex
2. Google
3. Mail

## Как работает OAuth2
Последовательность действий при регистрации пользователя с помощью социальной сети следующая:

1. Сначала нужно получить авторизационный URL-адрес провайдера социальной сети, на который
необходимо перенаправить пользователя. При этом необходимо передать `client_redirect_uri` - адрес
вашего сайта, на который будет отправлен код авторизации;
2. Попав на авторизационный URL, пользователь должен подтвердить доступ сервиса Auth-movies к его
аккаунту. Доступ предоставляется на чтение имени, логина и email;
3. Как только пользователь подтверждает доступ, ему выдается авторизационный код. После этого
сервис Auth-movies отправляет GET запрос на адрес, указанный в `client_redirect_uri` (см. п.1);
4. Ваше веб приложение должно принять поступивший GET запрос, получить из него все параметры,
включая код авторизации и обменять его на пару `access_token` и `refresh_token` - токены доступа
для сервиса онлайн-кинотеатра Movies.

``` mermaid
sequenceDiagram
  participant W as Web-app
  participant A as Auth-movies
  participant Y as Yandex
  autonumber
  Note left of W: Войти через yandex
  W->>A: POST /authorize-url
  A->>W: `authorize_url`
  W->>Y: Направить пользователя на `authorize_url`
  Note right of Yandex: Подтверждение доступа
  Y->>A: code
  A->>W: code
  W->>A: POST /authorize
  A->>W: access_token
```
